---
created: 2025-07-17
tags:
  - guide
  - Git
  - GarbageCollection
  - reviewed
---
# 1. Git Garbage Collection (GC) 이란?

> Git은 파일 변경 내역을 저장할 때 **많은 "객체(object)" 파일**을 내부적으로 생성합니다.  
> 이 파일들이 쌓이면 저장소가 커지고 속도도 느려질 수 있습니다.

|작업|설명|
|---|---|
|**Loose object 압축**|낱개 파일들을 pack 파일로 묶어서 디스크 용량 줄임|
|**불필요한 파일 제거**|삭제된 브랜치나 참조되지 않는 커밋들을 삭제|
|**Reflog 정리**|히스토리 중 복구 불가능한 커밋 삭제|
|**.git 디렉토리 최적화**|내부 저장소 구조 정리 (공간과 성능 향상)|

# 2. 사용법

## Git GC 실행 전 안전 백업 절차 (시간 포함)
### 1단계: **Stash에 시간 포함해 백업**
```
git stash push -m "🛑 GC 이전 백업 - $(date '+%Y-%m-%d %H:%M:%S')"
```

- 커밋되지 않은 수정 사항을 안전하게 숨김
- `stash list`로 언제든지 복원 가능
- 복원 명령:
```
git stash pop
```


### 2단계: **현재 커밋 상태 ZIP 백업 (시간 포함)**
```
git archive -o "vault_backup_$(date '+%Y%m%d_%H%M%S').zip" HEAD
```
- 현재 커밋 상태 전체를 `.zip` 파일로 저장
- 외부 보관 또는 Obsidian 외부 클라우드로도 이동 가능

### 3단계: **`.git` 폴더 자체 복사 (전체 히스토리 포함)**
```
cp -r .git "../vault_git_backup_$(date '+%Y%m%d_%H%M%S')"
```
- Git 로그, 브랜치, 리모트 정보까지 완전 백업됨
- 만약 GC 후 문제가 생기면 `.git` 폴더만 덮어써도 복구 가능

## 기본 명령어 (안전함):
```
git gc
```

## 더 강력한 정리 (주의 필요):
```
git gc --aggressive --prune=now
```

| 옵션             | 설명                                               |
| -------------- | ------------------------------------------------ |
| `--aggressive` | 압축률 최대화, 속도는 느리지만 효과 좋음                          |
| `--prune=now`  | **더 이상 참조되지 않는 객체 즉시 삭제** (안전하지 않은 커밋도 날아갈 수 있음) |

## 추천 주기

| 사용자 유형                  | 주기                                | 이유                          |
| ----------------------- | --------------------------------- | --------------------------- |
| 하루 수십 커밋 + 이미지 첨부 많은 경우 | **1~2개월마다** `git gc --aggressive` | 성능 및 용량 둘 다 개선              |

